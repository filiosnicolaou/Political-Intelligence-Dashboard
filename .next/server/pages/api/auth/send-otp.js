"use strict";(()=>{var e={};e.id=698,e.ids=[698],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},5472:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>p,routeModule:()=>h});var a={};t.r(a),t.d(a,{default:()=>handler});var o=t(1802),n=t(7153),s=t(6249),i=t(6113),l=t(1693),u=t(7027);let d=require("twilio");var c=t.n(d);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let{phone:t}=e.body;if(!t)return r.status(400).json({error:"Phone required"});let a=String((0,i.randomInt)(1e5,999999)),o=(0,u.b)(a),n=new Date(Date.now()+3e5);try{await l.Z.oTP.deleteMany({where:{phone:t}}),await l.Z.oTP.create({data:{phone:t,codeHash:o,expiresAt:n}});let e=process.env.TWILIO_SID,s=process.env.TWILIO_AUTH,i=process.env.TWILIO_PHONE;if(e&&s&&i){let r=c()(e,s);await r.messages.create({to:t,from:i,body:`PoliConnect OTP: ${a}`})}else console.log(`OTP for ${t}: ${a}`);r.status(200).json({ok:!0})}catch(e){console.error(e),r.status(500).json({error:"Server error"})}}let p=(0,s.l)(a,"default"),f=(0,s.l)(a,"config"),h=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/send-otp",pathname:"/api/auth/send-otp",bundlePath:"",filename:""},userland:a})},7027:(e,r,t)=>{t.d(r,{Z:()=>verifyHash,b:()=>hashOtp});var a=t(6113),o=t.n(a);let n=process.env.OTP_SECRET||"dev_otp_secret";function hashOtp(e){return o().createHmac("sha256",n).update(e).digest("hex")}function verifyHash(e,r){let t=hashOtp(e),a=Buffer.from(t),n=Buffer.from(r);return a.length===n.length&&o().timingSafeEqual(a,n)}},1693:(e,r,t)=>{t.d(r,{Z:()=>n});let a=require("@prisma/client"),o=global.prisma||new a.PrismaClient,n=o}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222],()=>__webpack_exec__(5472));module.exports=t})();